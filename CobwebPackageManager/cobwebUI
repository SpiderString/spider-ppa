--Can be bound to ChatSendFilter or to a key
local args={...}

--These are all default values, these are overwritten by (valid) values stored in the config file
local autoUpdatePackages=true
local commandPrefix="!cpm"


local cli=run("commandLib.lua")

function updateSettings()
  run("fileLib")
  local settings=readConfig()
  autoUpdatePackages=settings["autoUpdatePackages"]
  commandPrefix=settings["commandPrefix"]
end
function help()

end
--trigger ui
if args[1]:lower()=="key" then
  --ui code goes here

--parse commands
elseif args[1]:lower()=="event" and args[2]:lower()=="chatsendfilter" then
  updateSettings()

  local command=cli.getArguments(args[3], commandPrefix)
  if command then
    --begin command matching
    if command[1]=="update" then
      run("fileLib")
      if command[2] then
        getRepositories(command[2])
      else
        getRepositories()
      end
    elseif command[1]=="upgrade" then
      run("autoUpdate", true)
    elseif command[1]=="install" and command[2] then
      run("fileLib")
      if autoUpdatePackages then
        getRepositories(commandArgs[3])
      end
      getPackage(commandArgs[2], commandArgs[3])
    elseif command[1]=="help" then
      help()
    elseif command[1]=="list" then
      listPackages()
    end
  else
    return args[3]
  end
end

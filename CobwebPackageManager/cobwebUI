--Can be bound to ChatSendFilter or to a key
local args={...}

--These are all default values, these are overwritten by (valid) values stored in the config file
local autoUpdatePackages=true
local commandPrefix="!cpm"
local httpTimeout=15
local repositoryListPath="macros/CobwebPackageManager/repositoryList"
local packageListPath="macros/CobwebPackageManager/packageList"
local packageVersionsPath="macros/CobwebPackageManager/packageVersions"
local httpColor="&5"
local statusColor="&b"
local autoUpdateColor="&6"

run("CobwebPackageManager/spiderLib")
function getVars()
  run("CobwebPackageManager/fileLib")  

end
function help()
  
end
--trigger ui
if args[1]:lower()=="key" then
  --ui code goes here

--parse commands
elseif args[1]:lower()=="event" and args[2]:lower()=="chatsendfilter" then
  --local command, caller=stripUsername(args[3], args[4])
  --local commandArgs
  command, commandArgs=getCommand(commandPrefix, args[3])
  if command~=false then
    --begin command matching
    if command=="update" then
      run("CobwebPackageManager/fileLib")
      getRepositories(commandArgs[1])
    elseif command=="upgrade" then
      run("CobwebPackageManager/autoUpdate", true)
    elseif command=="install" and commandArgs[1]~=nil then
      run("CobwebPackageManager/fileLib")
      if autoUpdatePackages then
        getRepositories(commandArgs[2])
      end
      getPackage(commandArgs[1], commandArgs[2])
    elseif command=="help" then
      help()
    end
  else
    return args[3]
  end
end

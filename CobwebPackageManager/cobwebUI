--Can be bound to ChatSendFilter or to a key
local args={...}

--These are all default values, these are overwritten by (valid) values stored in the config file
local autoUpdatePackages=true
local commandPrefix="!cpm"


run("spiderLib")

function updateSettings()
  run("fileLib")
  local settings=readConfig()
  autoUpdatePackages=settings["autoUpdatePackages"]
  commandPrefix=settings["commandPrefix"]
end
function help()
  
end
--trigger ui
if args[1]:lower()=="key" then
  --ui code goes here

--parse commands
elseif args[1]:lower()=="event" and args[2]:lower()=="chatsendfilter" then
  updateSettings()

  command, commandArgs=getCommand(commandPrefix, args[3])
  if command~=false then
    --begin command matching
    if command=="update" then
      run("fileLib")
      getRepositories(commandArgs[1])
    elseif command=="upgrade" then
      run("autoUpdate", true)
    elseif command=="install" and commandArgs[1]~=nil then
      run("fileLib")
      if autoUpdatePackages then
        getRepositories(commandArgs[2])
      end
      getPackage(commandArgs[1], commandArgs[2])
    elseif command=="help" then
      help()
    elseif command=="list" then
      listPackages()
    end
  else
    return args[3]
  end
end
